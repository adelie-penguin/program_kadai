# STGの最適解判別プログラム

[Standard Task Graph Set (STG)](https://www.kasahara.cs.waseda.ac.jp/schedule/)のVersion 2.0の最適解を出力するプログラムです。


- 本プログラムが出力する最適解の数値は2013年時点でWebページに公開されていたものです。
- 現在のコンピュータならば当時のコンピュータが算出できなかった問題の最適解も算出可能であると思われます。
- 「単独での利用」で正しく動作することを確認してから「自作プログラム内での利用」をお願いします。
- `opt.c`内の関数は，プログラムを実行するたびに`stg.opt`ファイルを読み込みますので，コンパイル後も`stg.opt`ファイルを消さないでください。

## 単独での利用
デモ用のmain関数を実行し，下記2項目を表示します。
- 引数で指定された問題の最適解の上限と下限
- 引き数で指定された問題の最適解が40であるかを判別した結果

### コンパイルコマンド
デモ用main関数を利用するために`-D___COMPILE_ALONE`オプションを付けてください。(オプションの`_`は3連続です)
```
gcc opt.c -D___COMPILE_ALONE
```
### 実行コマンド
問題を指定するために2つの引数を必要とします。
```
./a.out [arg1] [arg2]
```
上記コマンドの`[arg1]`にはタスクグラフのファイル名を，`[arg2]`には並列実行で利用可能なプロセッサ台数を設定します。  
例えば，「50タスクの問題`rand0000.stg`を4プロセッサで並列実行する問題」の最適解を調べるための実行コマンドは下記の様になります。
```
./a.out stg/2.0/50/rand0000.stg 4
```

### 実行時の注意
- `[arg2]`で指定可能なプロセッサ台数は2, 4, 8, 16です。
- `[arg1]`で入力された文字列には、`/`記号を用いたファイルパスの切り分けを実施しています。このため， `../penguin/stg/2.0/50/rand0000.stg`や`../../stg/2.0/50/rand0000.stg`
のように参照パスを含めた文字列を指定することができます。


## 自作プログラム内での利用

### ソースコードの保存場所
`opt.c`と`stg.opt`を自作プログラムと同じディレクトリ内に保存してください。

### ソースコードの編集
#### 手順1
自作プログラム内に下記のプロトタイプ宣言を追加してください。  
(プロトタイプ宣言は`#include<stdio.h>`のようにライブラリをインクルードした直下に記入することが多いです。)
```
extern int check_opt(char *stg_name, int pe, int upper);
```
#### 手順2

|       |データ型| 機能 |
|-------|-------|-----|
| 戻り値 |int型| |
| stg_name |char*型| |
| pe | int型 | |
|upper | int型| |

### コンパイルコマンド

一般的な分割コンパイルを利用していただければ問題ありません。  
面倒な場合は，これまで利用してコンパイルコマンドのソースコード名の後ろに` opt.c`と追記してください。
例えば，自作プログラムのファイル名がmain.cである場合，下記のように書けばmain.cでopt.cの関数を利用可能です。
```
gcc main.c opt.c
```
自作プログラム内で利用する場合は，`-D___COMPILE_ALONE`オプションを付けないように注意してください。


## プログラムファイルのダウンロード

下記のgitコマンドかブラウザ機能を利用してファイルを保存してください．  
```
git clone --depth=1 -b kadai03 https://github.com/adelie-penguin/program_kadai
```
